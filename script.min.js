const OBSTACLES=document.querySelectorAll(".js--obstacle"),GRAVITE=50;let vaisseau={x:100,y:100,element:document.querySelector(".js--vaisseau"),reacteur:document.querySelector(".js--reacteur"),vitesse:15,inclinaison:10},keys={};function Timer(e,t){var s=setInterval(e,t);this.stop=function(){return s&&(clearInterval(s),s=null),this},this.start=function(){return s||(this.stop(),s=setInterval(e,t)),this},this.reset=function(e=t){return t=e,this.stop().start()}}keys.UP="ArrowUp",keys.RIGHT="ArrowRight",keys.DOWN="ArrowDown",keys.LEFT="ArrowLeft",OBSTACLES.forEach(function(e,t){e.setAttribute("id","obstacle-"+t)});var gravite=new Timer(function(){deplaceVaisseau(0,1)},GRAVITE);function enCollision(e,t){e=e.getBoundingClientRect(),t=t.getBoundingClientRect();return!(e.top+e.height<t.top||e.top>t.top+t.height||e.left+e.width<t.left||e.left>t.left+t.width)}function enCollisionVaisseau(e,t){return e.x<t.offsetLeft+t.offsetWidth&&e.x+e.element.offsetWidth>t.offsetLeft&&e.y<t.offsetTop+t.offsetHeight&&e.y+e.element.offsetHeight>t.offsetTop}document.addEventListener("keydown",function(e){detectionClavier(e),gravite.stop()}),document.addEventListener("keyup",function(e){detectionClavier(e),vaisseau.element.style.transform="",vaisseau.reacteur.style.transform="",gravite.start()});let detectionClavier=function(e){e.preventDefault();var t=e.key;keys[t]="keydown"==e.type},goto=function(e,t,s){switch(s){case"horizontal":vaisseau.x+=e||0;break;case"vertical":vaisseau.y+=t||0;break;case"haut":-1===t&&(vaisseau.y+=t||0);break;case"droite":1===e&&(vaisseau.x+=e||0);break;case"bas":1===t&&(vaisseau.y+=t||0);break;case"gauche":-1===e&&(vaisseau.x+=e||0)}},hitbox=function(t,e,s,a){let o=!0,i=!0,r=!0,n=!0;t.element.offsetTop+t.element.clientHeight-1===a.offsetTop&&(a.style.borderTopColor="cyan",gravite.stop(),goto(e,s,"haut"),OBSTACLES.forEach(function(e){enCollisionVaisseau(t,e)&&e.id!=a.id&&(o=!1)}),o)&&goto(e,s,"horizontal"),t.element.offsetTop===a.offsetTop+a.clientHeight&&(a.style.borderBottomColor="cyan",goto(e,s,"bas"),OBSTACLES.forEach(function(e){enCollisionVaisseau(t,e)&&e.id!=a.id&&(i=!1)}),i)&&goto(e,s,"horizontal"),t.element.offsetLeft===a.offsetLeft+a.clientWidth&&(a.style.borderRightColor="cyan",goto(e,s,"droite"),OBSTACLES.forEach(function(e){enCollisionVaisseau(t,e)&&e.id!=a.id&&(n=!1)}),n)&&goto(e,s,"vertical"),t.element.offsetLeft+t.element.clientWidth-1===a.offsetLeft&&(a.style.borderLeftColor="cyan",goto(e,s,"gauche"),OBSTACLES.forEach(function(e){enCollisionVaisseau(t,e)&&e.id!=a.id&&(r=!1)}),r)&&goto(e,s,"vertical")},deplaceVaisseau=function(s,a){for(var e=0;e<vaisseau.vitesse;e++){let t=!0;OBSTACLES.forEach(function(e){enCollisionVaisseau(vaisseau,e)?(t=!1,hitbox(vaisseau,s,a,e)):(e.style.borderTopColor=null,e.style.borderRightColor=null,e.style.borderBottomColor=null,e.style.borderLeftColor=null)}),t&&(goto(s,a,"horizontal"),goto(s,a,"vertical")),vaisseau.element.style.left=vaisseau.x+"px",vaisseau.element.style.top=vaisseau.y+"px"}};var controlVaisseau=function(){vaisseau.reacteur.classList.remove(vaisseau.reacteur.dataset.boost),keys[keys.UP]&&(deplaceVaisseau(0,-1),vaisseau.reacteur.classList.add(vaisseau.reacteur.dataset.boost)),keys[keys.RIGHT]&&(deplaceVaisseau(1,0),vaisseau.element.style.transform=`rotate(${vaisseau.inclinaison}deg)`,vaisseau.reacteur.style.transform=`rotate(${90-vaisseau.inclinaison}deg)`),keys[keys.DOWN]&&(deplaceVaisseau(0,1),vaisseau.reacteur.style.transform="rotate(180deg)"),keys[keys.LEFT]&&(deplaceVaisseau(-1,0),vaisseau.element.style.transform=`rotate(-${vaisseau.inclinaison}deg)`,vaisseau.reacteur.style.transform=`rotate(-${90-vaisseau.inclinaison}deg)`),keys[keys.DOWN]&&keys[keys.LEFT]&&(vaisseau.reacteur.style.transform="rotate(-135deg)"),keys[keys.DOWN]&&keys[keys.RIGHT]&&(vaisseau.reacteur.style.transform="rotate(135deg)"),keys[keys.UP]&&keys[keys.LEFT]&&(vaisseau.reacteur.style.transform="rotate(-45deg)"),keys[keys.UP]&&keys[keys.RIGHT]&&(vaisseau.reacteur.style.transform="rotate(45deg)")};deplaceVaisseau(),setInterval(function(){controlVaisseau()},1e3/24);