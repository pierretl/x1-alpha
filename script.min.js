const VAISSEAU=document.querySelector(".js--vaisseau"),REACTEUR=document.querySelector(".js--reacteur"),OBSTACLES=document.querySelectorAll(".js--obstacle"),DISTANCE=30;function Timer(e,t){var o=setInterval(e,t);this.stop=function(){return o&&(clearInterval(o),o=null),this},this.start=function(){return o||(this.stop(),o=setInterval(e,t)),this},this.reset=function(e=t){return t=e,this.stop().start()}}OBSTACLES.forEach(function(e,t){e.setAttribute("id","obstacle-"+t)});var chuteVaisseau=new Timer(function(){},20);function enCollision(e,t){e=e.getBoundingClientRect(),t=t.getBoundingClientRect();return!(e.top+e.height<t.top||e.top>t.top+t.height||e.left+e.width<t.left||e.left>t.left+t.width)}chuteVaisseau.stop(),document.querySelector(".js--pause").addEventListener("click",function(){chuteVaisseau.stop()}),document.querySelector(".js--play").addEventListener("click",function(){chuteVaisseau.start()});var keys={UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown",LEFT:"ArrowLeft"},character={x:300,y:100,speedMultiplier:10,element:VAISSEAU};function detectionClavier(e){e.preventDefault();var t=e.key;keys[t]="keydown"==e.type}function enCollisionOffset(e,t){return e.x<t.offsetLeft+t.offsetWidth&&e.x+e.element.offsetWidth>t.offsetLeft&&e.y<t.offsetTop+t.offsetHeight&&e.y+e.element.offsetHeight>t.offsetTop}function enCollisionOffsetTest(e,t){return e.x+e.element.offsetWidth<t.offsetLeft}function goto(e,t,o){switch(o){case"horizontal":character.x+=e||0;break;case"vertical":character.y+=t||0;break;case"haut":-1===t&&(character.y+=t||0);break;case"droite":1===e&&(character.x+=e||0);break;case"bas":1===t&&(character.y+=t||0);break;case"gauche":-1===e&&(character.x+=e||0)}}function removeObjectWithId(e,t){var o=e.findIndex(e=>e.id===t);return e.splice(o,1),e}function hitbox(t,e,o,r){let s=!0,a=!0,n=!0,c=!0;VAISSEAU.offsetTop+VAISSEAU.clientHeight-1===r.offsetTop&&(r.style.borderTopColor="cyan",goto(e,o,"haut"),OBSTACLES.forEach(function(e){enCollisionOffset(t,e)&&e.id!=r.id&&(s=!1)}),s)&&goto(e,o,"horizontal"),VAISSEAU.offsetTop===r.offsetTop+r.clientHeight&&(r.style.borderBottomColor="cyan",goto(e,o,"bas"),OBSTACLES.forEach(function(e){enCollisionOffset(t,e)&&e.id!=r.id&&(a=!1)}),a)&&goto(e,o,"horizontal"),VAISSEAU.offsetLeft===r.offsetLeft+r.clientWidth&&(r.style.borderRightColor="cyan",goto(e,o,"droite"),OBSTACLES.forEach(function(e){enCollisionOffset(t,e)&&e.id!=r.id&&(c=!1)}),c)&&goto(e,o,"vertical"),VAISSEAU.offsetLeft+VAISSEAU.clientWidth-1===r.offsetLeft&&(r.style.borderLeftColor="cyan",goto(e,o,"gauche"),OBSTACLES.forEach(function(e){enCollisionOffset(t,e)&&e.id!=r.id&&(n=!1)}),n)&&goto(e,o,"vertical")}document.addEventListener("keydown",function(e){detectionClavier(e),chuteVaisseau.stop()}),document.addEventListener("keyup",function(e){detectionClavier(e),VAISSEAU.style.transform="",REACTEUR.style.transform="",chuteVaisseau.start()});var moveCharacter=function(o,r){for(var e=0;e<character.speedMultiplier;e++){let t=!0;OBSTACLES.forEach(function(e){enCollisionOffset(character,e)?(t=!1,hitbox(character,o,r,e)):(e.style.borderTopColor=null,e.style.borderRightColor=null,e.style.borderBottomColor=null,e.style.borderLeftColor=null)}),t&&(goto(o,r,"horizontal"),goto(o,r,"vertical")),character.element.style.left=character.x+"px",character.element.style.top=character.y+"px"}},detectCharacterMovement=function(){REACTEUR.classList.remove(REACTEUR.dataset.boost),keys[keys.UP]&&(moveCharacter(0,-1),REACTEUR.classList.add(REACTEUR.dataset.boost)),keys[keys.RIGHT]&&(moveCharacter(1,0),VAISSEAU.style.transform="rotate(15deg)",REACTEUR.style.transform="rotate(75deg)"),keys[keys.DOWN]&&(moveCharacter(0,1),REACTEUR.style.transform="rotate(180deg)"),keys[keys.LEFT]&&(moveCharacter(-1,0),VAISSEAU.style.transform="rotate(-15deg)",REACTEUR.style.transform="rotate(-75deg)"),keys[keys.DOWN]&&keys[keys.LEFT]&&(REACTEUR.style.transform="rotate(-135deg)"),keys[keys.DOWN]&&keys[keys.RIGHT]&&(REACTEUR.style.transform="rotate(135deg)"),keys[keys.UP]&&keys[keys.LEFT]&&(REACTEUR.style.transform="rotate(-45deg)"),keys[keys.UP]&&keys[keys.RIGHT]&&(REACTEUR.style.transform="rotate(45deg)")};moveCharacter(),setInterval(function(){detectCharacterMovement()},1e3/24);